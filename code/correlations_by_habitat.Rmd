---
title: "correlation_by_habitat"
author: "Becca Van Hoeck"
date: "2/15/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## load packages

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)

```

## load data

```{r}

metricsSG = read.csv("data/clean_data/ecometricsSeagrass.csv")
metricsC = read.csv("data/clean_data/ecometricsCreek.csv")
metricsM = read.csv("data/clean_data/ecometricsMudflat.csv")
ecometrics = read.csv("data/clean_data/ecometrics.csv")

```

## Explore grouping by habitat type

```{r}
# SPL by Habitat
ggplot(data = ecometrics, aes(x = habitat, y = avg_spl_low))+ theme_bw()+
  geom_boxplot()

splbyhabitat = lm(avg_spl_low ~ habitat, data = ecometrics)
summary(splbyhabitat)
SPLbyHabAOV = aov(splbyhabitat)
TukeyHSD(SPLbyHabAOV)

ggplot(data = ecometrics, aes(x = habitat, y = avg_spl_high))+ theme_bw()+
  geom_boxplot()

splHbyhabitat = lm(avg_spl_high ~ habitat, data = ecometrics)
summary(splbyhabitat)
SPLHbyHabAOV = aov(splHbyhabitat)
TukeyHSD(SPLHbyHabAOV)


# # SPL by nearest adj habitat type (landscape) 
# ggplot(data = metricsSG, aes(x = adj_hab_type, y = avg_spl_low))+ theme_bw()+
#   geom_boxplot()
# 
# ggplot(data = metricsSG, aes(x = adj_hab_type, y = avg_spl_high))+ theme_bw()+
#   geom_boxplot()
# 
# ggplot(data = metricsC, aes(x = adj_hab_type, y = avg_spl_low))+ theme_bw()+
#   geom_boxplot()
# 
# ggplot(data = metricsC, aes(x = adj_hab_type, y = avg_spl_high))+ theme_bw()+
#   geom_boxplot()
# 
# ggplot(data = metricsM, aes(x = adj_hab_type, y = avg_spl_low))+ theme_bw()+
#   geom_boxplot()
# 
# ggplot(data = metricsM, aes(x = adj_hab_type, y = avg_spl_high))+ theme_bw()+
#   geom_boxplot()

# SPL by distance to adjacent habitat patch (landscape) 
# ggplot(data = metricsSG, aes(x = dist2adjPatch, y = avg_spl_low))+ theme_bw()+
#   geom_point()
# cor(metricsSG$dist2adjPatch,metricsSG$avg_spl_low)
# 
# ggplot(data = metricsSG, aes(x = dist2adjPatch, y = avg_spl_high))+ theme_bw()+
#   geom_point()
# cor(metricsSG$dist2adjPatch,metricsSG$avg_spl_high)

ggplot(data = metricsC, aes(x = dist2adjPatch, y = avg_spl_low))+ theme_bw()+
  geom_point()
cor(metricsC$dist2adjPatch,metricsC$avg_spl_low)

# ggplot(data = metricsC, aes(x = dist2adjPatch, y = avg_spl_high))+ theme_bw()+
#   geom_point()
# cor(metricsSG$dist2adjPatch,metricsSG$avg_spl_high)

ggplot(data = metricsM, aes(x = dist2adjPatch, y = avg_spl_low))+ theme_bw()+
  geom_point()
cor(metricsM$dist2adjPatch, metricsM$avg_spl_low)

ggplot(data = metricsM, aes(x = dist2adjPatch, y = avg_spl_high))+ theme_bw()+
  geom_point()
cor(metricsM$dist2adjPatch, metricsM$avg_spl_high)


# Total catch by habitat
ggplot(data = ecometrics, aes(x = habitat, y = total_abund_sum))+ theme_bw()+
  geom_boxplot()


# add label for position within seagrass bed - within, adjacent, other? 
STposition = read.csv("data/metadata/hydrophone_seagrass_position.csv")
metricsSG = left_join(metricsSG, STposition, by = "site_code")

ggplot(data = metricsSG, aes(x = position, y = avg_spl_low))+ theme_bw()+
  geom_boxplot()

SPLbySTposition = lm(avg_spl_low ~ position, data = metricsSG)
TukeyHSD(aov(SPLbySTposition))


```

## Remove non-numeric columns for correlations

```{r}

metricsSG_num = metricsSG %>%
  select(-X, -deploy_num, -site, -bare, -Habitat, -site_code, -habitat, -soniferous, -index, -total_hab_area, -adj_hab_type)

metricsC_num = metricsC %>%
  select(-X, -deploy_num, -site, -bare, -Habitat, -site_code, -habitat, -soniferous, -index, -total_hab_area, -adj_hab_type)

metricsM_num = metricsM %>%
  select(-X, -deploy_num, -site, -bare, -Habitat, -site_code, -habitat, -soniferous, -index, -total_hab_area, -adj_hab_type)

```

## Seagrass only: correlations

```{r}
CorSeagrass = as.data.frame(cor(metricsSG_num, method = "pearson", use = "everything"))
write.csv(CorSeagrass, "data/clean_data/CorrelationSeagrass.csv")

metricsSG$deploy_num = factor(metricsSG$deploy_num)

# seagrassFiltered = read.csv("data/clean_data/CorrelationSeagrass_noRedundant.csv")
# metricsSG_Filt = metricsSG_num %>%
#   select(all_of(colnames(seagrassFiltered[,-1])))
```

# SPL Low

Need to review these correlations and make decisions before summarizing
# retain ruppia, but correlated with num_ort_chr and habitat total
# retain num_bai_chr but corr. w/ num_ort_chr & num_ops_tau
# seagrass_area is correlated with habitat_total, num_bai_chr & num_ort_chr

```{r}
# Covariates of interest:
halodule
zostera
habitat_total
saltmarsh_area
num_ort_chr 
planktivore
piscivore
omni_2
avg_temp

# covariates of interest with redundant correlations
# ruppia - likely remove (cor w/ num_ort_chr & habitat_total)
# num_bai_chr # cor with num_ort_chr & num_ops_tau
# num_ops_tau - likely remove (low sample size and correlations)

# Example fig to replicate
halodule = ggplot(aes(x = halodule, y = avg_spl_low),data = ecometrics)+ theme_bw()+
  geom_point(aes(color = habitat))+
  geom_smooth(method = "lm", formula = 'y ~x', se = FALSE, color = "black")+
  xlab("Halodule cover")+
  ylab("Average SPL (dB re 1 uPa)")+
  theme(axis.title = element_text(size = 16), 
        axis.text = element_text(size = 14),
        legend.position = "none")
cor(ecometrics$halodule, ecometrics$avg_spl_low, method = "pearson")

```

## SPL High

```{r}

zostera
oyster_area
saltmarsh_area
soniferous_S
comm_evenness_sum
piscivore
omni_2
sal_avg
avg_temp
depth_m_avg

```

# Toadfish

```{r}

avg_shoot_density
oyster_area
richness_landscape
comm_evenness_sum
soniferous_S
omni_2
total_abund_sum
sal_avg

```

